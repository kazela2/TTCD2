<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Qu·∫£n l√≠ B·∫£ng X·∫øp H·∫°ng</title>
    <link rel="stylesheet" href="/CSS/quanli_xephang.css" />
</head>
<body>
    <div class="sidebar">
        <h2>Qu·∫£n Tr·ªã</h2>
        <a href="quanlygiaidau.html">üì¶ Qu·∫£n l√Ω Gi·∫£i ƒê·∫•u</a>
        <a href="quanlydoituyenvathanhvien.html">üßæ Qu·∫£n l√Ω ƒê·ªôi Tuy·ªÉn v√† Th√†nh Vi√™n</a>
        <a href="quanli_trandau.html">üë• Qu·∫£n l√Ω Tr·∫≠n ƒê·∫•u</a>
        <a href="quanli_xephang.html">üìä Qu·∫£n L√Ω B·∫£ng X·∫øp H·∫°ng</a>
        <a href="quanli_lichsu.html">üìä L·ªãch S·ª≠ Gi·∫£i ƒê·∫•u</a>
        <a href="index.html">Quay L·∫°i</a>
      </div>

    <div class="main-content">
        <div class="header">
            <h1>Qu·∫£n L√Ω B·∫£ng X·∫øp H·∫°ng</h1>
            <div class="header-actions">
                <button id="toggle-form-btn">‚ûï Th√™m M·ªõi</button>
                <button id="refresh-btn">üîÑ T·∫£i l·∫°i</button>
            </div>
        </div>

        <!-- Form th√™m m·ªõi (·∫©n m·∫∑c ƒë·ªãnh) -->
        <form id="form-add" style="display:none;">
            <h3>Th√™m m·ªõi B·∫£ng X·∫øp H·∫°ng</h3>
            <label for="input-iddoi">Id ƒê·ªôi Tuy·ªÉn:</label>
            <input type="number" id="input-iddoi" required />

            <label for="input-idgiai">Id Gi·∫£i ƒê·∫•u:</label>
            <input type="number" id="input-idgiai" required />

            <label for="input-tranthang">Tr·∫≠n Th·∫Øng:</label>
            <input type="number" id="input-tranthang" value="0" min="0" required />

            <label for="input-tranhoa">Tr·∫≠n H√≤a:</label>
            <input type="number" id="input-tranhoa" value="0" min="0" required />

            <label for="input-tranthua">Tr·∫≠n Thua:</label>
            <input type="number" id="input-tranthua" value="0" min="0" required />

            <label for="input-hieuso">Hi·ªáu S·ªë:</label>
            <input type="number" id="input-hieuso" value="0" required />

            <label for="input-diem">ƒêi·ªÉm:</label>
            <input type="number" id="input-diem" value="0" required />

            <button type="submit" id="save-btn">üíæ L∆∞u</button>
            <button type="button" id="cancel-btn">‚ùå H·ªßy</button>
        </form>

        <!-- N∆°i hi·ªÉn th·ªã b·∫£ng x·∫øp h·∫°ng -->
        <div id="data-container"></div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:5000';

        // H√†m t·∫£i d·ªØ li·ªáu b·∫£ng x·∫øp h·∫°ng v√† hi·ªÉn th·ªã
        async function loadBangXepHang() {
            const container = document.getElementById('data-container');
            container.innerHTML = '<p>ƒêang t·∫£i d·ªØ li·ªáu...</p>';
            try {
                const response = await fetch(`${API_BASE}/BangXepHang/GetAll`);
                if (!response.ok) throw new Error(`L·ªói server: ${response.status}`);
                const data = await response.json();

                if (!data || data.length === 0) {
                    container.innerHTML = '<p>üìä Kh√¥ng c√≥ d·ªØ li·ªáu b·∫£ng x·∫øp h·∫°ng.</p>';
                    return;
                }

                let html = '<ul class="ranking-list">';
                data.forEach((item, index) => {
                    html += `
                        <li class="ranking-item">
                            <div>
                                <strong>H·∫°ng ${index + 1}</strong> - 
                                <strong>ƒê·ªôi:</strong> ${item.TenDoi}, 
                                <strong>Gi·∫£i:</strong> ${item.TenGiai}, 
                                <strong>Th·∫Øng:</strong> ${item.TranThang}, 
                                <strong>H√≤a:</strong> ${item.TranHoa}, 
                                <strong>Thua:</strong> ${item.TranThua}, 
                                <strong>Hi·ªáu s·ªë:</strong> ${item.HieuSo}, 
                                <strong>ƒêi·ªÉm:</strong> ${item.Diem}
                            </div>
                            <button onclick="xoaXepHang(${item.Id})" class="btn-delete">üóëÔ∏è X√≥a</button>
                        </li>
                    `;
                });
                html += '</ul>';
                container.innerHTML = html;
            } catch (error) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                container.innerHTML = `<p class="error">‚ùå L·ªói: ${error.message}</p>`;
            }
        }

        // H√†m x√≥a b·∫£n ghi b·∫£ng x·∫øp h·∫°ng theo id
        async function xoaXepHang(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?')) return;
            try {
                const response = await fetch(`${API_BASE}/BangXepHang/Delete/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                alert(result.message || result.error);
                loadBangXepHang();
            } catch (error) {
                console.error('L·ªói khi x√≥a:', error);
                alert('‚ùå Kh√¥ng th·ªÉ x√≥a: ' + error.message);
            }
        }

        // H√†m th√™m m·ªõi b·∫£ng x·∫øp h·∫°ng
        async function themXepHangForm(event) {
            event.preventDefault(); // NgƒÉn reload trang

            const doiInput = document.getElementById('input-iddoi');
            const giaiInput = document.getElementById('input-idgiai');
            const tranThangInput = document.getElementById('input-tranthang');
            const tranHoaInput = document.getElementById('input-tranhoa');
            const tranThuaInput = document.getElementById('input-tranthua');
            const hieuSoInput = document.getElementById('input-hieuso');
            const diemInput = document.getElementById('input-diem');

            // Ki·ªÉm tra d·ªØ li·ªáu h·ª£p l·ªá
            if (
                !doiInput.value || !giaiInput.value ||
                tranThangInput.value < 0 || tranHoaInput.value < 0 || tranThuaInput.value < 0
            ) {
                alert('‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† h·ª£p l·ªá c√°c tr∆∞·ªùng.');
                return;
            }

            const data = {
                IdDoi: parseInt(doiInput.value),
                IdGiai: parseInt(giaiInput.value),
                TranThang: parseInt(tranThangInput.value),
                TranHoa: parseInt(tranHoaInput.value),
                TranThua: parseInt(tranThuaInput.value),
                HieuSo: parseInt(hieuSoInput.value),
                Diem: parseInt(diemInput.value)
            };

            try {
                const response = await fetch(`${API_BASE}/BangXepHang/Add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.message || result.error);

                if (!result.error) {
                    // Clear form v√† ·∫©n form
                    doiInput.value = '';
                    giaiInput.value = '';
                    tranThangInput.value = '0';
                    tranHoaInput.value = '0';
                    tranThuaInput.value = '0';
                    hieuSoInput.value = '0';
                    diemInput.value = '0';

                    toggleForm(false);
                    loadBangXepHang();
                }
            } catch (error) {
                console.error('L·ªói khi th√™m:', error);
                alert('‚ùå Kh√¥ng th·ªÉ th√™m m·ªõi: ' + error.message);
            }
        }

        // B·∫≠t/t·∫Øt hi·ªÉn th·ªã form
        function toggleForm(show) {
            const form = document.getElementById('form-add');
            form.style.display = show ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadBangXepHang();

            // B·∫≠t/t·∫Øt form
            document.getElementById('toggle-form-btn').addEventListener('click', () => {
                const form = document.getElementById('form-add');
                toggleForm(form.style.display !== 'block');
            });

            // N√∫t t·∫£i l·∫°i d·ªØ li·ªáu
            document.getElementById('refresh-btn').addEventListener('click', loadBangXepHang);

            // L∆∞u d·ªØ li·ªáu
            document.getElementById('form-add').addEventListener('submit', themXepHangForm);

            // H·ªßy form
            document.getElementById('cancel-btn').addEventListener('click', () => {
                toggleForm(false);
            });
        });
    </script>
</body>
</html>
