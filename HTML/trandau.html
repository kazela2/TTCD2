<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫≠n ƒê·∫•u</title>
    <link rel="stylesheet" href="/CSS/trandau.css">
</head>
<body>
    <div class="header">
        <div class="logo">üéÆ</div>
        <div class="nav">
          <a href="index.html">Trang ch·ªß</a>
          <a href="giaidau.html">Gi·∫£i ƒë·∫•u</a>
          <div class="dropdown">
            <a href="#">ƒê·ªôi thi ƒë·∫•u ‚ñæ</a>
            <div class="dropdown-content">
              <a href="timdoituyen.html">T√¨m ƒë·ªôi tuy·ªÉn</a>
              <a href="taodoituyen.html">T·∫°o ƒë·ªôi tuy·ªÉn</a>
            </div>
          </div>
          <a href="trandau.html">Tr·∫≠n ƒê·∫•u</a>
          <a href="xephang.html">B·∫£ng X·∫øp H·∫°ng</a>
          <a href="lichsugiaidau.html">L·ªãch S·ª≠ ƒê·∫•u</a>
          <a href="admin.html">Qu·∫£n L√Ω</a>
        </div>
    </div>


    <div class="container">
        <h1 class="page-title">üìÖ L·ªãch Tr·∫≠n ƒê·∫•u</h1>
        
        <!-- B·ªô l·ªçc -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="tournamentFilter">L·ªçc theo gi·∫£i ƒë·∫•u:</label>
                    <select id="tournamentFilter">
                        <option value="">T·∫•t c·∫£ gi·∫£i ƒë·∫•u</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="statusFilter">Tr·∫°ng th√°i:</label>
                    <select id="statusFilter">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="finished">ƒê√£ k·∫øt th√∫c</option>
                        <option value="upcoming">S·∫Øp di·ªÖn ra</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            üîÑ ƒêang t·∫£i d·ªØ li·ªáu...
        </div>

        <!-- Error -->
        <div id="error" class="error" style="display: none;">
            ‚ùå C√≥ l·ªói x·∫£y ra khi t·∫£i d·ªØ li·ªáu!
        </div>

        <!-- Danh s√°ch tr·∫≠n ƒë·∫•u -->
        <div id="matchesContainer" class="matches-grid" style="display: none;">
            <!-- C√°c tr·∫≠n ƒë·∫•u s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
        </div>

        <!-- Kh√¥ng c√≥ tr·∫≠n ƒë·∫•u -->
        <div id="noMatches" class="no-matches" style="display: none;">
            <div class="no-matches-icon">‚öΩ</div>
            <h3>Ch∆∞a c√≥ tr·∫≠n ƒë·∫•u n√†o</h3>
            <p>Hi·ªán t·∫°i ch∆∞a c√≥ tr·∫≠n ƒë·∫•u n√†o ƒë∆∞·ª£c l√™n l·ªãch.</p>
        </div>
    </div>

    <script>
        // URL API
        const API_BASE = 'http://localhost:5000';
        
        // Global variables
        let allMatches = [];
        let tournaments = [];

        // DOM elements
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const matchesContainer = document.getElementById('matchesContainer');
        const noMatches = document.getElementById('noMatches');
        const tournamentFilter = document.getElementById('tournamentFilter');
        const statusFilter = document.getElementById('statusFilter');

        // Fetch data khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            loadTournaments();
            loadMatches();
            
            // Event listeners cho filter
            tournamentFilter.addEventListener('change', filterMatches);
            statusFilter.addEventListener('change', filterMatches);
        });

        // Load danh s√°ch gi·∫£i ƒë·∫•u cho filter
        async function loadTournaments() {
            try {
                const response = await fetch(`${API_BASE}/GiaiDau/GetAll`);
                tournaments = await response.json();
                
                // Populate tournament filter
                tournaments.forEach(tournament => {
                    const option = document.createElement('option');
                    option.value = tournament.IdGiai;
                    option.textContent = tournament.TenGiai;
                    tournamentFilter.appendChild(option);
                });
            } catch (err) {
                console.error('Error loading tournaments:', err);
            }
        }

        // Load danh s√°ch tr·∫≠n ƒë·∫•u
        async function loadMatches() {
            try {
                showLoading();
                
                const response = await fetch(`${API_BASE}/TranDau/GetAll`);
                if (!response.ok) {
                    throw new Error('Failed to fetch matches');
                }
                
                allMatches = await response.json();
                renderMatches(allMatches);
                hideLoading();
                
            } catch (err) {
                console.error('Error loading matches:', err);
                showError();
            }
        }

        // Render danh s√°ch tr·∫≠n ƒë·∫•u
        function renderMatches(matches) {
            if (matches.length === 0) {
                showNoMatches();
                return;
            }

            matchesContainer.style.display = 'grid';
            noMatches.style.display = 'none';
            
            matchesContainer.innerHTML = matches.map(match => `
                <div class="match-card">
                    <div class="match-header">
                        <div class="tournament-name">${match.TenGiai || 'Gi·∫£i ƒë·∫•u'}</div>
                        <div class="match-date">${formatDate(match.NgayThiDau)}</div>
                    </div>
                    
                    <div class="teams-container">
                        <div class="team">
                            <div class="team-logo">üèÜ</div>
                            <div class="team-name">${match.TenDoi1 || 'ƒê·ªôi 1'}</div>
                        </div>
                        
                        <div class="vs">VS</div>
                        
                        <div class="team">
                            <div class="team-logo">üèÜ</div>
                            <div class="team-name">${match.TenDoi2 || 'ƒê·ªôi 2'}</div>
                        </div>
                    </div>
                    
                    <div class="score ${match.TySo ? '' : 'no-score'}">
                        ${match.TySo || 'Ch∆∞a thi ƒë·∫•u'}
                    </div>
                    
                    <div class="match-info">
                        <div class="venue">
                            üìç ${match.DiaDiem || 'Ch∆∞a x√°c ƒë·ªãnh'}
                        </div>
                        <div class="match-status">
                            ${getMatchStatus(match)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter tr·∫≠n ƒë·∫•u
        function filterMatches() {
            const tournamentId = tournamentFilter.value;
            const status = statusFilter.value;
            
            let filteredMatches = allMatches;
            
            // Filter theo gi·∫£i ƒë·∫•u
            if (tournamentId) {
                filteredMatches = filteredMatches.filter(match => 
                    match.IdGiai == tournamentId
                );
            }
            
            // Filter theo tr·∫°ng th√°i
            if (status) {
                filteredMatches = filteredMatches.filter(match => {
                    if (status === 'finished') {
                        return match.TySo && match.TySo.trim() !== '';
                    } else if (status === 'upcoming') {
                        return !match.TySo || match.TySo.trim() === '';
                    }
                    return true;
                });
            }
            
            renderMatches(filteredMatches);
        }

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return 'Ch∆∞a x√°c ƒë·ªãnh';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function getMatchStatus(match) {
            if (match.TySo && match.TySo.trim() !== '') {
                return '‚úÖ ƒê√£ k·∫øt th√∫c';
            } else {
                return '‚è∞ S·∫Øp di·ªÖn ra';
            }
        }

        function showLoading() {
            loading.style.display = 'block';
            error.style.display = 'none';
            matchesContainer.style.display = 'none';
            noMatches.style.display = 'none';
        }

        function hideLoading() {
            loading.style.display = 'none';
        }

        function showError() {
            loading.style.display = 'none';
            error.style.display = 'block';
            matchesContainer.style.display = 'none';
            noMatches.style.display = 'none';
        }

        function showNoMatches() {
            loading.style.display = 'none';
            error.style.display = 'none';
            matchesContainer.style.display = 'none';
            noMatches.style.display = 'block';
        }
    </script>
</body>
</html>