<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lá»‹ch Sá»­</title>
    <link rel="stylesheet" href="/CSS/lichsudau.css">
</head>
<body>
        <div class="header">
        <div class="logo">ğŸ®</div>
        <div class="nav">
          <a href="index.html">Trang chá»§</a>
          <a href="giaidau.html">Giáº£i Ä‘áº¥u</a>
          <div class="dropdown">
            <a href="#">Äá»™i thi Ä‘áº¥u â–¾</a>
            <div class="dropdown-content">
              <a href="timdoituyen.html">TÃ¬m Ä‘á»™i tuyá»ƒn</a>
              <a href="taodoituyen.html">Táº¡o Ä‘á»™i tuyá»ƒn</a>
            </div>
          </div>
          <a href="trandau.html">Tráº­n Äáº¥u</a>
          <a href="xephang.html">Báº£ng Xáº¿p Háº¡ng</a>
          <a href="lichsugiaidau.html">Lá»‹ch Sá»­ Äáº¥u</a>
          <a href="admin.html">Quáº£n LÃ½</a>
        </div>
    </div>

        <div class="main-content">
        <h1 class="page-title">ğŸ“š Lá»‹ch Sá»­ Giáº£i Äáº¥u</h1>
        
        <div class="controls">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” TÃ¬m kiáº¿m theo tÃªn giáº£i Ä‘áº¥u, nÄƒm hoáº·c Ä‘á»™i vÃ´ Ä‘á»‹ch...">
                <button class="btn btn-secondary" onclick="searchHistory()">TÃ¬m kiáº¿m</button>
            </div>
        </div>

        <div class="history-container">
            <div id="loading" class="loading">â³ Äang táº£i dá»¯ liá»‡u...</div>
            <div id="noData" class="no-data" style="display: none;">ğŸ“­ KhÃ´ng cÃ³ dá»¯ liá»‡u lá»‹ch sá»­ giáº£i Ä‘áº¥u</div>
            
            <table class="history-table" id="historyTable" style="display: none;">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>TÃªn Giáº£i Äáº¥u</th>
                        <th>NÄƒm</th>
                        <th>Äá»™i VÃ´ Äá»‹ch</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>

        <div class="stats-section">
            <h2 class="stats-title">ğŸ† Thá»‘ng KÃª Äá»™i VÃ´ Äá»‹ch</h2>
            <div id="statsLoading" class="loading">â³ Äang táº£i thá»‘ng kÃª...</div>
            <table class="stats-table" id="statsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Äá»™i Tuyá»ƒn</th>
                        <th>Sá»‘ Láº§n VÃ´ Äá»‹ch</th>
                        <th>NÄƒm Äáº§u TiÃªn</th>
                        <th>NÄƒm Gáº§n Nháº¥t</th>
                    </tr>
                </thead>
                <tbody id="statsTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal thÃªm/sá»­a lá»‹ch sá»­ -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">â• ThÃªm Lá»‹ch Sá»­ Giáº£i Äáº¥u</div>
            <form id="historyForm">
                <div class="form-group">
                    <label for="selectGiai">Giáº£i Äáº¥u *</label>
                    <select id="selectGiai" required>
                        <option value="">-- Chá»n giáº£i Ä‘áº¥u --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inputNam">NÄƒm *</label>
                    <input type="number" id="inputNam" min="1900" max="2030" required placeholder="VÃ­ dá»¥: 2024">
                </div>
                <div class="form-group">
                    <label for="selectDoiVoDich">Äá»™i VÃ´ Äá»‹ch *</label>
                    <select id="selectDoiVoDich" required>
                        <option value="">-- Chá»n Ä‘á»™i vÃ´ Ä‘á»‹ch --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inputMoTa">MÃ´ Táº£</label>
                    <textarea id="inputMoTa" placeholder="MÃ´ táº£ vá» giáº£i Ä‘áº¥u nÄƒm nÃ y..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">Há»§y</button>
                    <button type="submit" class="btn btn-primary">LÆ°u</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let allHistory = [];
        let currentEditId = null;

        // Load dá»¯ liá»‡u khi trang Ä‘Æ°á»£c táº£i
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
            loadStats();
            loadGiaiDau();
            loadDoiThiDau();
        });

        // Táº£i danh sÃ¡ch lá»‹ch sá»­
        async function loadHistory() {
            try {
                const response = await fetch('http://localhost:5000/LichSuGiaiDau/GetAll');
                const data = await response.json();
                
                allHistory = data;
                displayHistory(data);
                
                document.getElementById('loading').style.display = 'none';
                if (data.length === 0) {
                    document.getElementById('noData').style.display = 'block';
                } else {
                    document.getElementById('historyTable').style.display = 'table';
                }
            } catch (error) {
                console.error('Lá»—i khi táº£i dá»¯ liá»‡u:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('noData').style.display = 'block';
            }
        }

        // Hiá»ƒn thá»‹ dá»¯ liá»‡u lá»‹ch sá»­
        function displayHistory(data) {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><span class="tournament-name">${item.TenGiai || 'N/A'}</span></td>
                    <td><span class="year-badge">${item.Nam}</span></td>
                    <td><span class="champion-badge">ğŸ† ${item.TenDoiVoDich || 'N/A'}</span></td>
                    <td><span class="description" title="${item.MoTa || ''}">${item.MoTa || 'KhÃ´ng cÃ³ mÃ´ táº£'}</span></td>
                    <td>
                        <button class="btn btn-secondary" onclick="editHistory(${item.Idls})" style="margin-right: 5px; padding: 5px 10px;">âœï¸ Sá»­a</button>
                        <button class="btn btn-cancel" onclick="deleteHistory(${item.Idls})" style="padding: 5px 10px;">ğŸ—‘ï¸ XÃ³a</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Táº£i thá»‘ng kÃª
        async function loadStats() {
            try {
                const response = await fetch('http://localhost:5000/LichSuGiaiDau/ThongKe');
                const data = await response.json();
                
                displayStats(data);
                document.getElementById('statsLoading').style.display = 'none';
                document.getElementById('statsTable').style.display = 'table';
            } catch (error) {
                console.error('Lá»—i khi táº£i thá»‘ng kÃª:', error);
                document.getElementById('statsLoading').style.display = 'none';
            }
        }

        // Hiá»ƒn thá»‹ thá»‘ng kÃª
        function displayStats(data) {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '';

            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.TenDoi}</strong></td>
                    <td><span class="champion-badge">${item.SoLanVoDich}</span></td>
                    <td>${item.NamDauTien}</td>
                    <td>${item.NamGanNhat}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Táº£i danh sÃ¡ch giáº£i Ä‘áº¥u
        async function loadGiaiDau() {
            try {
                const response = await fetch('http://localhost:5000/GiaiDau/GetAll');
                const data = await response.json();
                
                const select = document.getElementById('selectGiai');
                select.innerHTML = '<option value="">-- Chá»n giáº£i Ä‘áº¥u --</option>';
                
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.IdGiai;
                    option.textContent = item.TenGiai;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Lá»—i khi táº£i giáº£i Ä‘áº¥u:', error);
            }
        }

        // Táº£i danh sÃ¡ch Ä‘á»™i thi Ä‘áº¥u
        async function loadDoiThiDau() {
            try {
                const response = await fetch('http://localhost:5000/DoiThiDau/GetAll');
                const data = await response.json();
                
                const select = document.getElementById('selectDoiVoDich');
                select.innerHTML = '<option value="">-- Chá»n Ä‘á»™i vÃ´ Ä‘á»‹ch --</option>';
                
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.IdDoi;
                    option.textContent = item.TenDoi;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Lá»—i khi táº£i Ä‘á»™i thi Ä‘áº¥u:', error);
            }
        }

        // TÃ¬m kiáº¿m
        function searchHistory() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = allHistory.filter(item => 
                (item.TenGiai && item.TenGiai.toLowerCase().includes(searchTerm)) ||
                (item.Nam && item.Nam.toString().includes(searchTerm)) ||
                (item.TenDoiVoDich && item.TenDoiVoDich.toLowerCase().includes(searchTerm)) ||
                (item.MoTa && item.MoTa.toLowerCase().includes(searchTerm))
            );
            
            displayHistory(filteredData);
        }

                // TÃ¬m kiáº¿m realtime
        document.getElementById('searchInput').addEventListener('input', function() {
            searchHistory();
        });
    </script>
</body>
</html>