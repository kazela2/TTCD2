<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω T√†i Kho·∫£n Qu·∫£n Tr·ªã</title>
    <link rel="stylesheet" href="/CSS/quanli_taikhoan.css">
</head>
<body>
    <div class="sidebar">
        <h2>üõ°Ô∏è Qu·∫£n Tr·ªã</h2>
        <a href="quanlygiaidau.html">üì¶ Qu·∫£n l√Ω Gi·∫£i ƒê·∫•u</a>
        <a href="quanly_Team_Player.html">üßæ Qu·∫£n l√Ω Team v√† Player</a>
        <a href="quanli_trandau.html">üéÆ Qu·∫£n l√Ω Tr·∫≠n ƒê·∫•u</a>
        <a href="quanli_xephang.html">üìä Qu·∫£n L√Ω B·∫£ng X·∫øp H·∫°ng</a>
        <a href="quanli_taikhoan.html" class="active">ü™™ Qu·∫£n L√Ω T√†i kho·∫£n</a>
        <a href="quanli_map.html">üó∫Ô∏è Qu·∫£n L√Ω Chi Ti·∫øt Map</a>
        <a href="index.html">üè† Quay L·∫°i</a>
    </div>

    <div class="main-content">
        <div class="container">
            <div class="header">
                <h1>ü™™ Qu·∫£n L√Ω T√†i Kho·∫£n Qu·∫£n Tr·ªã</h1>
                <p>Qu·∫£n l√Ω th√¥ng tin t√†i kho·∫£n qu·∫£n tr·ªã vi√™n h·ªá th·ªëng</p>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openAddModal()">
                    ‚ûï Th√™m Qu·∫£n Tr·ªã Vi√™n
                </button>
                <button class="btn btn-success" onclick="refreshData()">
                    üîÑ L√†m M·ªõi
                </button>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3>üìã Danh S√°ch Qu·∫£n Tr·ªã Vi√™n</h3>
                    <input type="text" class="search-box" placeholder="üîç T√¨m ki·∫øm..." id="searchInput">
                </div>
                
                <div id="loadingDiv" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>

                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n ƒêƒÉng Nh·∫≠p</th>
                            <th>H·ªç T√™n</th>
                            <th>Vai Tr√≤</th>
                            <th>M√¥ T·∫£</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c load t·ª´ API -->
                    </tbody>
                </table>

                <div id="noDataDiv" class="no-data" style="display: none;">
                    <p>üì≠ Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Th√™m Qu·∫£n Tr·ªã Vi√™n -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>‚ûï Th√™m Qu·∫£n Tr·ªã Vi√™n M·ªõi</h4>
                <span class="close" onclick="closeModal('addModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addForm">
                    <div class="form-group">
                        <label for="addTenDangNhap">T√™n ƒêƒÉng Nh·∫≠p *</label>
                        <input type="text" class="form-control" id="addTenDangNhap" required>
                    </div>
                    <div class="form-group">
                        <label for="addMatKhau">M·∫≠t Kh·∫©u *</label>
                        <input type="password" class="form-control" id="addMatKhau" required minlength="6">
                        <small style="color: #666;">T·ªëi thi·ªÉu 6 k√Ω t·ª±</small>
                    </div>
                    <div class="form-group">
                        <label for="addHoTen">H·ªç T√™n *</label>
                        <input type="text" class="form-control" id="addHoTen" required>
                    </div>
                    <div class="form-group">
                        <label for="addVaiTro">Vai Tr√≤ *</label>
                        <select class="form-control" id="addVaiTro" required>
                            <option value="">-- Ch·ªçn vai tr√≤ --</option>
                            <option value="Admin">Admin</option>
                            <option value="Moderator">Moderator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addMoTa">M√¥ T·∫£</label>
                        <textarea class="form-control" id="addMoTa" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addModal')">H·ªßy</button>
                <button type="button" class="btn btn-primary" onclick="addAdmin()">Th√™m</button>
            </div>
        </div>
    </div>

    <!-- Modal S·ª≠a Qu·∫£n Tr·ªã Vi√™n -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>‚úèÔ∏è S·ª≠a Th√¥ng Tin Qu·∫£n Tr·ªã Vi√™n</h4>
                <span class="close" onclick="closeModal('editModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editId">
                    <div class="form-group">
                        <label for="editTenDangNhap">T√™n ƒêƒÉng Nh·∫≠p</label>
                        <input type="text" class="form-control" id="editTenDangNhap" readonly style="background-color: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label for="editHoTen">H·ªç T√™n *</label>
                        <input type="text" class="form-control" id="editHoTen" required>
                    </div>
                    <div class="form-group">
                        <label for="editVaiTro">Vai Tr√≤ *</label>
                        <select class="form-control" id="editVaiTro" required>
                            <option value="Admin">Admin</option>
                            <option value="Moderator">Moderator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editMoTa">M√¥ T·∫£</label>
                        <textarea class="form-control" id="editMoTa" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">H·ªßy</button>
                <button type="button" class="btn btn-warning" onclick="updateAdmin()">C·∫≠p Nh·∫≠t</button>
            </div>
        </div>
    </div>

    <!-- Modal ƒê·ªïi M·∫≠t Kh·∫©u -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>üîë ƒê·ªïi M·∫≠t Kh·∫©u</h4>
                <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <input type="hidden" id="changePasswordId">
                    <div class="form-group">
                        <label for="matKhauCu">M·∫≠t Kh·∫©u C≈© *</label>
                        <input type="password" class="form-control" id="matKhauCu" required>
                    </div>
                    <div class="form-group">
                        <label for="matKhauMoi">M·∫≠t Kh·∫©u M·ªõi *</label>
                        <input type="password" class="form-control" id="matKhauMoi" required minlength="6">
                        <small style="color: #666;">T·ªëi thi·ªÉu 6 k√Ω t·ª±</small>
                    </div>
                    <div class="form-group">
                        <label for="xacNhanMatKhau">X√°c Nh·∫≠n M·∫≠t Kh·∫©u M·ªõi *</label>
                        <input type="password" class="form-control" id="xacNhanMatKhau" required minlength="6">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">H·ªßy</button>
                <button type="button" class="btn btn-primary" onclick="changePassword()">ƒê·ªïi M·∫≠t Kh·∫©u</button>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c load t·ª´ API
        let adminData = [];

        // Hi·ªÉn th·ªã d·ªØ li·ªáu
        function displayData(data = adminData) {
            const tableBody = document.getElementById('tableBody');
            const noDataDiv = document.getElementById('noDataDiv');
            const dataTable = document.getElementById('dataTable');

            if (data.length === 0) {
                dataTable.style.display = 'none';
                noDataDiv.style.display = 'block';
                return;
            }

            dataTable.style.display = 'table';
            noDataDiv.style.display = 'none';

            tableBody.innerHTML = '';
            data.forEach(admin => {
                const badgeClass = admin.VaiTro === 'Admin' ? 'badge-admin' : 'badge-moderator';
                const row = `
                    <tr>
                        <td>${admin.IdQuanTri}</td>
                        <td>${admin.TenDangNhap}</td>
                        <td>${admin.HoTen}</td>
                        <td><span class="badge ${badgeClass}">${admin.VaiTro}</span></td>
                        <td>${admin.MoTa || ''}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="openEditModal(${admin.IdQuanTri})">‚úèÔ∏è S·ª≠a</button>
                            <button class="btn btn-primary btn-sm" onclick="openChangePasswordModal(${admin.IdQuanTri})">üîë ƒê·ªïi MK</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteAdmin(${admin.IdQuanTri})">üóëÔ∏è X√≥a</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // T√¨m ki·∫øm
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredData = adminData.filter(admin => 
                admin.TenDangNhap.toLowerCase().includes(searchTerm) ||
                admin.HoTen.toLowerCase().includes(searchTerm) ||
                admin.VaiTro.toLowerCase().includes(searchTerm) ||
                (admin.MoTa && admin.MoTa.toLowerCase().includes(searchTerm))
            );
            displayData(filteredData);
        });

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Reset form
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
        }

        function openAddModal() {
            openModal('addModal');
        }

        function openEditModal(id) {
            const admin = adminData.find(a => a.IdQuanTri === id);
            if (admin) {
                document.getElementById('editId').value = admin.IdQuanTri;
                document.getElementById('editTenDangNhap').value = admin.TenDangNhap;
                document.getElementById('editHoTen').value = admin.HoTen;
                document.getElementById('editVaiTro').value = admin.VaiTro;
                document.getElementById('editMoTa').value = admin.MoTa || '';
                openModal('editModal');
            }
        }

        function openChangePasswordModal(id) {
            document.getElementById('changePasswordId').value = id;
            openModal('changePasswordModal');
        }

        // CRUD Operations (S·∫Ω k·∫øt n·ªëi API)
        function addAdmin() {
            const tenDangNhap = document.getElementById('addTenDangNhap').value;
            const matKhau = document.getElementById('addMatKhau').value;
            const hoTen = document.getElementById('addHoTen').value;
            const vaiTro = document.getElementById('addVaiTro').value;
            const moTa = document.getElementById('addMoTa').value;

            if (!tenDangNhap || !matKhau || !hoTen || !vaiTro) {
                alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
                return;
            }

            if (matKhau.length < 6) {
                alert('‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
                return;
            }

            // TODO: G·ªçi API POST /QuanTri/Register
            console.log('Th√™m qu·∫£n tr·ªã vi√™n:', { tenDangNhap, matKhau, hoTen, vaiTro, moTa });
            alert('‚ö†Ô∏è Ch·ª©c nƒÉng s·∫Ω ƒë∆∞·ª£c k·∫øt n·ªëi API sau!');
        }

        function updateAdmin() {
            const id = parseInt(document.getElementById('editId').value);
            const hoTen = document.getElementById('editHoTen').value;
            const vaiTro = document.getElementById('editVaiTro').value;
            const moTa = document.getElementById('editMoTa').value;

            if (!hoTen || !vaiTro) {
                alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
                return;
            }

            // TODO: G·ªçi API PUT /QuanTri/Update/{id}
            console.log('C·∫≠p nh·∫≠t qu·∫£n tr·ªã vi√™n:', { id, hoTen, vaiTro, moTa });
            alert('‚ö†Ô∏è Ch·ª©c nƒÉng s·∫Ω ƒë∆∞·ª£c k·∫øt n·ªëi API sau!');
        }

        function changePassword() {
            const id = parseInt(document.getElementById('changePasswordId').value);
            const matKhauCu = document.getElementById('matKhauCu').value;
            const matKhauMoi = document.getElementById('matKhauMoi').value;
            const xacNhanMatKhau = document.getElementById('xacNhanMatKhau').value;

            if (!matKhauCu || !matKhauMoi || !xacNhanMatKhau) {
                alert('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }

            if (matKhauMoi.length < 6) {
                alert('‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
                return;
            }

            if (matKhauMoi !== xacNhanMatKhau) {
                alert('‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi v√† x√°c nh·∫≠n m·∫≠t kh·∫©u kh√¥ng kh·ªõp!');
                return;
            }

            // TODO: G·ªçi API PUT /QuanTri/ChangePassword/{id}
            console.log('ƒê·ªïi m·∫≠t kh·∫©u:', { id, matKhauCu, matKhauMoi });
            alert('‚ö†Ô∏è Ch·ª©c nƒÉng s·∫Ω ƒë∆∞·ª£c k·∫øt n·ªëi API sau!');
        }

        function deleteAdmin(id) {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a qu·∫£n tr·ªã vi√™n n√†y?')) {
                // TODO: G·ªçi API DELETE /QuanTri/Delete/{id}
                console.log('X√≥a qu·∫£n tr·ªã vi√™n:', id);
                alert('‚ö†Ô∏è Ch·ª©c nƒÉng s·∫Ω ƒë∆∞·ª£c k·∫øt n·ªëi API sau!');
            }
        }

        function refreshData() {
            // TODO: G·ªçi API GET /QuanTri/GetAll
            console.log('L√†m m·ªõi d·ªØ li·ªáu');
            alert('‚ö†Ô∏è Ch·ª©c nƒÉng s·∫Ω ƒë∆∞·ª£c k·∫øt n·ªëi API sau!');
        }

        function loadData() {
            // TODO: G·ªçi API GET /QuanTri/GetAll ƒë·ªÉ load d·ªØ li·ªáu ban ƒë·∫ßu
            console.log('Load d·ªØ li·ªáu ban ƒë·∫ßu');
            displayData([]); // Hi·ªÉn th·ªã tr·ªëng
        }