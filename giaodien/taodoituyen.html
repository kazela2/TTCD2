<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Táº¡o Äá»™i Tuyá»ƒn</title>
    <link rel="stylesheet" href="/giaodien/taodoituyen.css">
</head>
<body>
    <div class="header">
        <div class="logo">ğŸ®</div>
        <div class="nav">
          <a href="index.html">Trang chá»§</a>
          <a href="giaidau.html">Giáº£i Ä‘áº¥u</a>
          <div class="dropdown">
            <a href="#">Äá»™i thi Ä‘áº¥u â–¾</a>
            <div class="dropdown-content">
              <a href="timdoituyen.html">TÃ¬m Ä‘á»™i tuyá»ƒn</a>
              <a href="taodoituyen.html">Táº¡o Ä‘á»™i tuyá»ƒn</a>
            </div>
          </div>
          <a href="trandau.html">Tráº­n Äáº¥u</a>
          <a href="xephang.html">Báº£ng Xáº¿p Háº¡ng</a>
          <a href="lichsugiaidau.html">Lá»‹ch Sá»­ Äáº¥u</a>
          <a href="admin.html">Quáº£n LÃ½</a>
        </div>
    </div>
    <div class="form-container">
    <h2>Táº¡o Äá»™i Tuyá»ƒn</h2>
    <form id="form-tao-doi" autocomplete="off">
  <div class="form-group">
    <label for="tenDoi">TÃªn Ä‘á»™i:</label>
    <input type="text" id="tenDoi" name="tenDoi" required />
  </div>
  <div class="form-group">
    <label for="tenHLV">TÃªn huáº¥n luyá»‡n viÃªn:</label>
    <input type="text" id="tenHLV" name="tenHLV" required />
  </div>
  <div class="form-group">
    <label for="selectGiaiDau">Giáº£i Ä‘áº¥u:</label>
    <select id="selectGiaiDau" name="selectGiaiDau" required>
      <!-- JS sáº½ load danh sÃ¡ch giáº£i Ä‘áº¥u á»Ÿ Ä‘Ã¢y -->
    </select>
  </div>

      <div class="members-container" id="membersContainer">
    <h3>ThÃ nh viÃªn</h3>
    <div class="member-block">
      <div class="form-group">
        <label>Há» tÃªn:</label>
        <input type="text" name="hoTen[]" required />
      </div>
      <div class="form-group">
        <label>Vá»‹ trÃ­:</label>
        <input type="text" name="viTri[]" />
      </div>
      <div class="form-group">
        <label>Sá»‘ Ã¡o:</label>
        <input type="number" name="soAo[]" />
      </div>
    </div>
  </div>

  <button type="button" class="add-btn" onclick="addMember()">+ ThÃªm thÃ nh viÃªn</button>
  <hr />
  <button type="submit" class="submit-btn">Táº¡o Ä‘á»™i tuyá»ƒn</button>
</form>

<script>
  // Load danh sÃ¡ch giáº£i Ä‘áº¥u vÃ o select
  async function loadGiaiDau() {
    try {
      const res = await fetch('http://127.0.0.1:5000/GiaiDau/GetAll');
      const giaiDauList = await res.json();
      const select = document.getElementById('selectGiaiDau');
      giaiDauList.forEach(giai => {
        const option = document.createElement('option');
        option.value = giai.IdGiai;
        option.textContent = giai.TenGiai;
        select.appendChild(option);
      });
    } catch (error) {
      console.error('Lá»—i load giáº£i Ä‘áº¥u:', error);
    }
  }
  window.onload = loadGiaiDau;

  function addMember() {
    const container = document.getElementById('membersContainer');
    const memberHTML = `
      <div class="member-block">
        <div class="form-group">
          <label>Há» tÃªn:</label>
          <input type="text" name="hoTen[]" required />
        </div>
        <div class="form-group">
          <label>Vá»‹ trÃ­:</label>
          <input type="text" name="viTri[]" />
        </div>
        <div class="form-group">
          <label>Sá»‘ Ã¡o:</label>
          <input type="number" name="soAo[]" />
        </div>
      </div>`;
    container.insertAdjacentHTML('beforeend', memberHTML);
  }

  // Xá»­ lÃ½ submit form
  document.getElementById('form-tao-doi').addEventListener('submit', async function(e) {
    e.preventDefault();

    const tenDoi = document.getElementById('tenDoi').value.trim();
    const tenHLV = document.getElementById('tenHLV').value.trim();
    const idGiai = document.getElementById('selectGiaiDau').value;

    // Láº¥y thÃ nh viÃªn
    const hoTens = [...document.getElementsByName('hoTen[]')].map(i => i.value.trim());
    const viTris = [...document.getElementsByName('viTri[]')].map(i => i.value.trim());
    const soAos = [...document.getElementsByName('soAo[]')].map(i => i.value.trim());

    const thanhVienList = hoTens.map((hoTen, idx) => ({
      HoTen: hoTen,
      ViTri: viTris[idx] || null,
      SoAo: soAos[idx] ? Number(soAos[idx]) : null
    }));

    const data = {
      TenDoi: tenDoi,
      TenHuanLuyenVien: tenHLV,
      IdGiai: Number(idGiai),
      ThanhVien: thanhVienList
    };

    try {
      const res = await fetch('http://127.0.0.1:5000/DoiThiDau/AddFull', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const result = await res.json();

      if (res.ok) {
        alert('Táº¡o Ä‘á»™i tuyá»ƒn thÃ nh cÃ´ng!');
        this.reset();
        // XÃ³a cÃ¡c thÃ nh viÃªn ngoÃ i thÃ nh viÃªn Ä‘áº§u tiÃªn
        const membersContainer = document.getElementById('membersContainer');
        membersContainer.innerHTML = `<h3>ThÃ nh viÃªn</h3>
          <div class="member-block">
            <div class="form-group">
              <label>Há» tÃªn:</label>
              <input type="text" name="hoTen[]" required />
            </div>
            <div class="form-group">
              <label>Vá»‹ trÃ­:</label>
              <input type="text" name="viTri[]" />
            </div>
            <div class="form-group">
              <label>Sá»‘ Ã¡o:</label>
              <input type="number" name="soAo[]" />
            </div>
          </div>`;
      } else {
        alert('Lá»—i: ' + result.error);
      }
    } catch (error) {
      alert('Lá»—i gá»­i dá»¯ liá»‡u: ' + error.message);
    }
  });
</script>
</body>
</html>