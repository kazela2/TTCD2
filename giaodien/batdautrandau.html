<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ch·ªçn Gi·∫£i ƒê·∫•u V√† ƒê·ªôi Thi ƒê·∫•u</title>
    <link rel="stylesheet" href="trandau.css" />
</head>
<body>
    <div class="header">
        <div class="logo">üéÆ</div>
        <div class="nav">
            <a href="index.html">Trang ch·ªß</a>
            <a href="giaidau.html">Gi·∫£i ƒë·∫•u</a>
            <div class="dropdown">
                <a href="#">ƒê·ªôi thi ƒë·∫•u ‚ñæ</a>
                <div class="dropdown-content">
                    <a href="timdoituyen.html">T√¨m ƒë·ªôi tuy·ªÉn</a>
                    <a href="taodoituyen.html">T·∫°o ƒë·ªôi tuy·ªÉn</a>
                </div>
            </div>
            <a href="trandau.html">Tr·∫≠n ƒê·∫•u</a>
            <a href="xephang.html">B·∫£ng X·∫øp H·∫°ng</a>
            <a href="lichsugiaidau.html">L·ªãch S·ª≠ ƒê·∫•u</a>
            <a href="admin.html">Qu·∫£n L√Ω</a>
        </div>
    </div>

    <div class="create">
        <button id="btnBatDau">B·∫Øt ƒê·∫ßu Tr·∫≠n ƒê·∫•u</button>

        <div id="form-trandau" class="form-trandau" style="display:none;">
            <label for="select-giaidau">Ch·ªçn Gi·∫£i ƒê·∫•u:</label>
            <select id="select-giaidau">
                <option value="">-- Ch·ªçn gi·∫£i ƒë·∫•u --</option>
            </select>

            <div id="teams-container" style="margin-top: 15px; display:none;">
                <h3>ƒê·ªôi tham gia:</h3>
                <div id="teams-cards" class="teams-cards"></div>

                <div class="form-group">
                    <label for="input-tyso">T·ª∑ s·ªë:</label>
                    <input type="text" id="input-tyso" placeholder="VD: 2-1" />
                </div>
                <div class="form-group">
                    <label for="input-ngaythidau">Ng√†y thi ƒë·∫•u:</label>
                    <input type="date" id="input-ngaythidau" />
                </div>
                <div class="form-group">
                    <label for="input-diadiem">ƒê·ªãa ƒëi·ªÉm:</label>
                    <input type="text" id="input-diadiem" placeholder="Nh·∫≠p ƒë·ªãa ƒëi·ªÉm" />
                </div>

                <button id="btn-create-trandau">T·∫°o Tr·∫≠n ƒê·∫•u</button>
            </div>
        </div>
    </div>

<script>
    document.getElementById('btnBatDau').addEventListener('click', () => {
        const form = document.getElementById('form-trandau');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';

        if (form.style.display === 'block') {
            loadGiaiDau();
        }
    });

    async function loadGiaiDau() {
        try {
            const res = await fetch('http://127.0.0.1:5000/GiaiDau/GetAll');
            const data = await res.json();

            const select = document.getElementById('select-giaidau');
            select.innerHTML = '<option value="">-- Ch·ªçn gi·∫£i ƒë·∫•u --</option>';

            data.forEach(giai => {
                const option = document.createElement('option');
                option.value = giai.IdGiai;
                option.textContent = giai.TenGiai;
                select.appendChild(option);
            });
        } catch (error) {
            alert('L·ªói t·∫£i danh s√°ch gi·∫£i ƒë·∫•u: ' + error.message);
        }
    }

    document.getElementById('select-giaidau').addEventListener('change', async function() {
        const idGiai = this.value;
        if (!idGiai) {
            document.getElementById('teams-container').style.display = 'none';
            return;
        }

        try {
            const res = await fetch(`http://127.0.0.1:5000/DoiThiDau/GetByGiai/${idGiai}`);
            const teams = await res.json();

            if (teams.length < 2) {
                alert('Gi·∫£i ƒë·∫•u n√†y ch∆∞a c√≥ ƒë·ªß 2 ƒë·ªôi thi ƒë·∫•u.');
                document.getElementById('teams-container').style.display = 'none';
                return;
            }

            const container = document.getElementById('teams-cards');
            container.innerHTML = '';

            // Ch·ªâ l·∫•y 2 ƒë·ªôi ƒë·∫ßu ti√™n
            for (let i = 0; i < 2; i++) {
                const team = teams[i];
                const div = document.createElement('div');
                div.style.border = '1px solid #ccc';
                div.style.padding = '10px';
                div.style.width = '200px';
                div.setAttribute('data-id', team.IdDoi); // L∆∞u IdDoi ·ªü ƒë√¢y ƒë·ªÉ d√πng sau
                div.innerHTML = `
                    <h4>${team.TenDoi}</h4>
                    <p><strong>HLV:</strong> ${team.TenHuanLuyenVien || 'Ch∆∞a c√≥'}</p>
                `;
                container.appendChild(div);
            }

            document.getElementById('teams-container').style.display = 'block';

        } catch (error) {
            alert('L·ªói t·∫£i ƒë·ªôi thi ƒë·∫•u: ' + error.message);
            document.getElementById('teams-container').style.display = 'none';
        }
    });

    document.getElementById('btn-create-trandau').addEventListener('click', async () => {
        const idGiai = document.getElementById('select-giaidau').value;
        const container = document.getElementById('teams-cards');
        const teams = container.children;
        if (!idGiai || teams.length < 2) {
            alert('B·∫°n ph·∫£i ch·ªçn gi·∫£i ƒë·∫•u v√† ƒë·∫£m b·∫£o c√≥ 2 ƒë·ªôi.');
            return;
        }

        const Doi1Id = teams[0].getAttribute('data-id');
        const Doi2Id = teams[1].getAttribute('data-id');

        const TySo = document.getElementById('input-tyso').value.trim();
        const NgayThiDau = document.getElementById('input-ngaythidau').value;
        const DiaDiem = document.getElementById('input-diadiem').value.trim();

        if (!TySo || !NgayThiDau || !DiaDiem) {
            alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß T·ª∑ s·ªë, Ng√†y thi ƒë·∫•u v√† ƒê·ªãa ƒëi·ªÉm.');
            return;
        }

        try {
            const res = await fetch('http://127.0.0.1:5000/TranDau/Add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    IdGiai: idGiai,
                    Doi1: Doi1Id,
                    Doi2: Doi2Id,
                    TySo,
                    NgayThiDau,
                    DiaDiem
                })
            });
            const data = await res.json();

            if (res.ok) {
                alert('T·∫°o tr·∫≠n ƒë·∫•u th√†nh c√¥ng!');
                document.getElementById('form-trandau').style.display = 'none';
                // B·∫°n c√≥ th·ªÉ g·ªçi l·∫°i h√†m loadTranDau() ·ªü trang tr·∫≠n ƒë·∫•u n·∫øu c·∫ßn
            } else {
                alert('L·ªói: ' + (data.error || 'Kh√¥ng r√µ l·ªói'));
            }
        } catch (error) {
            alert('L·ªói khi t·∫°o tr·∫≠n ƒë·∫•u: ' + error.message);
        }
    });
</script>
</body>
</html>
